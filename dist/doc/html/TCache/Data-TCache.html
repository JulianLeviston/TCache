<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.TCache</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Data-TCache.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">TCache-0.10.0.0: A Transactional cache with user-defined persistence</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Data.TCache</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Inherited from <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Concurrent.html#t:STM">STM</a></code> and variations
</a></li><li><a href="#g:2">Operations with cached database references
</a></li><li><a href="#g:3"><code>IResource</code> class
</a></li><li><a href="#g:4">Operations with cached objects
</a></li><li><a href="#g:5">Trigger operations
</a></li><li><a href="#g:6">Cache control
</a></li><li><a href="#g:7">Other
</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>TCache is a transactional cache with configurable persitence that permits
STM transactions with objects that syncronize sincromous or asyncronously with
their user defined storages. Default persistence in files is provided by default
</p><p>TCache implements ''DBRef' 's . They are persistent STM references  with a typical Haskell interface.
simitar to TVars (<code><a href="Data-TCache.html#v:newDBRef">newDBRef</a></code>, <code><a href="Data-TCache.html#v:readDBRef">readDBRef</a></code>, <code><a href="Data-TCache.html#v:writeDBRef">writeDBRef</a></code> etc) but with added. persistence
. DBRefs are serializable, so they can be stored and retrieved.
Because they are references,they point to other serializable registers.
This permits persistent mutable Inter-object relations
</p><p>For simple transactions of lists of objects of the same type TCache implements
inversion of control primitives <code><a href="Data-TCache.html#v:withSTMResources">withSTMResources</a></code> and variants, that call pure user defined code for registers update. Examples below.
</p><p>Triggers in <a href="Data-TCache-Triggers.html">Data.TCache.Triggers</a> are user defined hooks that are called back on register updates.
.They are used internally for indexing.
</p><p><a href="Data-TCache-IndexQuery.html">Data.TCache.IndexQuery</a> implements an straighforwards pure haskell type safe query language  based
 on register field relations. This module must be imported separately.
</p><p><a href="Data-TCache-IndexText.html">Data.TCache.IndexText</a> add full text search and content search to the query language
</p><p><a href="Data-TCache-DefaultPersistence.html">Data.TCache.DefaultPersistence</a> has instances for key indexation , serialization
 and default file persistence. The file persistence is more reliable, and the embedded IO reads inside STM transactions are safe.
</p><p><a href="Data-Persistent-Collection.html">Data.Persistent.Collection</a> implements a persistent, transactional collection with Queue interface as well as
 indexed access by key
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:atomically">atomically</a> ::  <a href="Data-TCache.html#t:STM">STM</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a</li><li class="src short"><a href="#v:atomicallySync">atomicallySync</a> ::  <a href="Data-TCache.html#t:STM">STM</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a</li><li class="src short"><span class="keyword">data</span>  <a href="#t:STM">STM</a> a</li><li class="src short"><a href="#v:unsafeIOToSTM">unsafeIOToSTM</a> ::  <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> a</li><li class="src short"><a href="#v:safeIOToSTM">safeIOToSTM</a> ::  <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> a</li><li class="src short"><span class="keyword">data</span>  <a href="#t:DBRef">DBRef</a> a</li><li class="src short"><a href="#v:getDBRef">getDBRef</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="Data-TCache.html#t:IResource">IResource</a> a) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a> -&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a</li><li class="src short"><a href="#v:keyObjDBRef">keyObjDBRef</a> ::  <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a></li><li class="src short"><a href="#v:newDBRef">newDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; <a href="Data-TCache.html#t:STM">STM</a> (<a href="Data-TCache.html#t:DBRef">DBRef</a> a)</li><li class="src short"><a href="#v:readDBRef">readDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:writeDBRef">writeDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:delDBRef">delDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><span class="keyword">class</span>  <a href="#t:IResource">IResource</a> a  <span class="keyword">where</span><ul class="subs"><li><a href="#v:keyResource">keyResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a></li><li><a href="#v:readResourceByKey">readResourceByKey</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li><a href="#v:readResource">readResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li><a href="#v:writeResource">writeResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li><a href="#v:delResource">delResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:Resources">Resources</a> a b<ul class="subs"><li>= <a href="#v:Retry">Retry</a>  </li><li>| <a href="#v:Resources">Resources</a> { <ul class="subs"><li><a href="#v:toAdd">toAdd</a> :: [a]</li><li><a href="#v:toDelete">toDelete</a> :: [a]</li><li><a href="#v:toReturn">toReturn</a> :: b</li></ul> }</li></ul></li><li class="src short"><a href="#v:resources">resources</a> ::  <a href="Data-TCache.html#t:Resources">Resources</a> a <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:withSTMResources">withSTMResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; ([<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a] -&gt; <a href="Data-TCache.html#t:Resources">Resources</a> a x) -&gt; <a href="Data-TCache.html#t:STM">STM</a> x</li><li class="src short"><a href="#v:withResources">withResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; ([<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a] -&gt; [a]) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:withResource">withResource</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a -&gt; a) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:getResources">getResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> [<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a]</li><li class="src short"><a href="#v:getResource">getResource</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:deleteResources">deleteResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:deleteResource">deleteResource</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:addTrigger">addTrigger</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; (<a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a>) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:flushDBRef">flushDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:flushAll">flushAll</a> :: <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Cache">Cache</a> = <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-IORef.html#t:IORef">IORef</a> (Ht, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a>)</li><li class="src short"><a href="#v:setCache">setCache</a> :: <a href="Data-TCache.html#t:Cache">Cache</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:newCache">newCache</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (Ht, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a>)</li><li class="src short"><a href="#v:syncCache">syncCache</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:setConditions">setConditions</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:clearSyncCache">clearSyncCache</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:numElems">numElems</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:syncWrite">syncWrite</a> :: <a href="Data-TCache.html#t:SyncMode">SyncMode</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li class="src short"><span class="keyword">data</span>  <a href="#t:SyncMode">SyncMode</a> <ul class="subs"><li>= <a href="#v:Synchronous">Synchronous</a>  </li><li>| <a href="#v:Asyncronous">Asyncronous</a> { <ul class="subs"><li><a href="#v:frecuency">frecuency</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></li><li><a href="#v:check">check</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a></li><li><a href="#v:cacheSize">cacheSize</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></li></ul> }</li><li>| <a href="#v:SyncManual">SyncManual</a>  </li></ul></li><li class="src short"><a href="#v:clearSyncCacheProc">clearSyncCacheProc</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a> -&gt; (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Concurrent.html#t:ThreadId">ThreadId</a></li><li class="src short"><a href="#v:defaultCheck">defaultCheck</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:onNothing">onNothing</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; m (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) -&gt; m b -&gt; m b</li></ul></div><div id="interface"><h1 id="g:1">Inherited from <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Concurrent.html#t:STM">STM</a></code> and variations
</h1><div class="top"><p class="src"><a name="v:atomically" class="def">atomically</a> ::  <a href="Data-TCache.html#t:STM">STM</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a</p><div class="doc"><p>Perform a series of STM actions atomically.
</p><p>You cannot use <code><a href="Data-TCache.html#v:atomically">atomically</a></code> inside an <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO-Unsafe.html#v:unsafePerformIO">unsafePerformIO</a></code> or <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO-Unsafe.html#v:unsafeInterleaveIO">unsafeInterleaveIO</a></code>.
 Any attempt to do so will result in a runtime error.  (Reason: allowing
 this would effectively allow a transaction inside a transaction, depending
 on exactly when the thunk is evaluated.)
</p><p>However, see <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/GHC-Conc.html#v:newTVarIO">newTVarIO</a></code>, which can be called inside <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO-Unsafe.html#v:unsafePerformIO">unsafePerformIO</a></code>,
 and which allows top-level TVars to be allocated.
</p></div></div><div class="top"><p class="src"><a name="v:atomicallySync" class="def">atomicallySync</a> ::  <a href="Data-TCache.html#t:STM">STM</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a</p><div class="doc"><p>Perform a synchronization of the cache with permanent storage once executed the STM transaction
 when <code><a href="Data-TCache.html#v:syncWrite">syncWrite</a></code> policy is <code><a href="Data-TCache.html#v:Synchronous">Synchronous</a></code>
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:STM" class="def">STM</a> a </p><div class="doc"><p>A monad supporting atomic memory transactions.
</p></div><div class="subs instances"><p id="control.i:STM" class="caption collapser" onclick="toggleSection('i:STM')">Instances</p><div id="section.i:STM" class="show"><table><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Monad.html#t:Monad">Monad</a> <a href="Data-TCache.html#t:STM">STM</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Monad.html#t:Functor">Functor</a> <a href="Data-TCache.html#t:STM">STM</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable1">Typeable1</a> <a href="Data-TCache.html#t:STM">STM</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Monad-Fix.html#t:MonadFix">MonadFix</a> <a href="Data-TCache.html#t:STM">STM</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Monad.html#t:MonadPlus">MonadPlus</a> <a href="Data-TCache.html#t:STM">STM</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg', <a href="Data-TCache.html#t:IResource">IResource</a> reg', <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg' -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg']) (<a href="Data-TCache.html#t:STM">STM</a> [b])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg' -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> (JoinData reg reg')) (<a href="Data-TCache.html#t:STM">STM</a> [([a], [b])])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [b])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [(a, b)])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [b]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; c) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [c])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg -&gt; b, reg -&gt; c) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [(a, b, c)])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [b]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; c) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [c]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; d) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [d])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg -&gt; b, reg -&gt; c, reg -&gt; d) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [(a, b, c, d)])</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:unsafeIOToSTM" class="def">unsafeIOToSTM</a> ::  <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> a</p><div class="doc"><p>Unsafely performs IO in the STM monad.  Beware: this is a highly
 dangerous thing to do.
</p><ul><li> The STM implementation will often run transactions multiple
     times, so you need to be prepared for this if your IO has any
     side effects.
</li><li> The STM implementation will abort transactions that are known to
     be invalid and need to be restarted.  This may happen in the middle
     of <code><a href="Data-TCache.html#v:unsafeIOToSTM">unsafeIOToSTM</a></code>, so make sure you don't acquire any resources
     that need releasing (exception handlers are ignored when aborting
     the transaction).  That includes doing any IO using Handles, for
     example.  Getting this wrong will probably lead to random deadlocks.
</li><li> The transaction may have seen an inconsistent view of memory when
     the IO runs.  Invariants that you expect to be true throughout
     your program may not be true inside a transaction, due to the
     way transactions are implemented.  Normally this wouldn't be visible
     to the programmer, but using <code><a href="Data-TCache.html#v:unsafeIOToSTM">unsafeIOToSTM</a></code> can expose it.
</li></ul></div></div><div class="top"><p class="src"><a name="v:safeIOToSTM" class="def">safeIOToSTM</a> ::  <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> a</p><div class="doc"><p>Assures that the IO computation finalizes no matter if the STM transaction
 is aborted or retried. The IO computation run in a different thread.
 The STM transaction wait until the completion of the IO procedure (or retry as usual)
 it can be retried if the embedding STM computation is retried
 so the IO computation must be idempotent.
 Exceptions are bubbled up to the STM transaction
</p></div></div><h1 id="g:2">Operations with cached database references
</h1><div class="doc"><p><code>DBRefs</code> are persistent cached database references in the STM monad
with read/write primitives, so the traditional syntax of Haskell STM references
can be used for  interfacing with databases. As expected, the DBRefs are transactional,
 because they operate in the STM monad.
</p><p>A <code>DBRef</code> is associated with its referred object trough its key.
Since DBRefs are serializable, they can be elements of mutable cached objects themselves. They could point to other mutable objects
and so on, so DBRefs can act as &quot;hardwired&quot; relations from mutable objects
to other mutable objects in the database/cache. their referred objects are loaded, saved and flused
to and from the cache automatically depending on the cache handling policies and the access needs
</p><p><code>DBRefs</code> are univocally identified by its pointed object keys, so they can be compared, ordered checked for equality so on.
The creation of a DBRef, trough <code><a href="Data-TCache.html#v:getDBRef">getDBRef</a></code> is pure. This permits an efficient lazy access to the
 registers trouth their DBRefs by lazy marshalling of the register content on demand.
</p><p>Example: Car registers have references to Person regiters
</p><pre>
data Person= Person {pname :: String} deriving  (Show, Read, Eq, Typeable)
data Car= Car{owner :: DBRef Person , cname:: String} deriving (Show, Read, Eq, Typeable)
</pre><p>Here the Car register point to the Person register trough the owner field
</p><p>To permit persistence and being refered with DBRefs, define the Indexable instance
for these two register types:
</p><pre>
instance Indexable Person where key Person{pname= n} = <a href="Person .html">Person </a> ++ n
instance Indexable Car where key Car{cname= n} = <a href="Car .html">Car </a> ++ n
</pre><p>Now we create a DBRef to a Person whose name is &quot;Bruce&quot;
</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let bruce =   getDBRef . key $ Person &quot;Bruce&quot; :: DBRef Person
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>show bruce
</code></strong>&gt;&quot;DBRef \&quot;Person bruce\&quot;&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>atomically (readDBRef bruce)
</code></strong>&gt;Nothing
</pre><p><code><a href="Data-TCache.html#v:getDBRef">getDBRef</a></code> is pure and creates the reference, but not the referred object;
To create both the reference and the DBRef, use <code><a href="Data-TCache.html#v:newDBRef">newDBRef</a></code>.
Lets create two Car's and its two Car DBRefs with bruce as owner:
</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>cars &lt;- atomically $  mapM newDBRef [Car bruce &quot;Bat Mobile&quot;, Car bruce &quot;Porsche&quot;]
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>print cars
</code></strong>&gt;[DBRef &quot;Car Bat Mobile&quot;,DBRef &quot;Car Porsche&quot;]
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>carRegs&lt;- atomically $ mapM readDBRef cars
</code></strong>&gt; [Just (Car {owner = DBRef &quot;Person bruce&quot;, cname = &quot;Bat Mobile&quot;})
&gt; ,Just (Car {owner = DBRef &quot;Person bruce&quot;, cname = &quot;Porsche&quot;})]
</pre><p>try to write with <code><a href="Data-TCache.html#v:writeDBRef">writeDBRef</a></code>
</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>atomically . writeDBRef bruce $ Person &quot;Other&quot;
</code></strong>&gt;*** Exception: writeDBRef: law of key conservation broken: old , new= Person bruce , Person Other
</pre><p>DBRef's can not be written with objects of different keys
</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>atomically . writeDBRef bruce $ Person &quot;Bruce&quot;
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let Just carReg1= head carRegs
</code></strong></pre><p>now from the Car register it is possible to recover the owner's register
</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>atomically $ readDBRef ( owner carReg1)
</code></strong>&gt;Just (Person {pname = &quot;bruce&quot;})
</pre><p>DBRefs, once the pointed cached object is looked up in the cache and found at creation, they does
not perform any further cache lookup afterwards, so reads and writes from/to DBRefs are faster
than *Resource(s) calls, which perform  cache lookups everytime the object is accessed
</p><p>DBRef's and <code>*Resource(s)</code> primitives are completely interoperable. The latter operate implicitly with DBRef's
</p></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:DBRef" class="def">DBRef</a> a </p><div class="subs instances"><p id="control.i:DBRef" class="caption collapser" onclick="toggleSection('i:DBRef')">Instances</p><div id="section.i:DBRef" class="show"><table><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable1">Typeable1</a> <a href="Data-TCache.html#t:DBRef">DBRef</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Eq.html#t:Eq">Eq</a> (<a href="Data-TCache.html#t:DBRef">DBRef</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Ord.html#t:Ord">Ord</a> (<a href="Data-TCache.html#t:DBRef">DBRef</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Text-Read.html#t:Read">Read</a> (<a href="Data-TCache.html#t:DBRef">DBRef</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Text-Show.html#t:Show">Show</a> (<a href="Data-TCache.html#t:DBRef">DBRef</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">SetOperations [<a href="Data-TCache.html#t:DBRef">DBRef</a> a] [<a href="Data-TCache.html#t:DBRef">DBRef</a> a] [<a href="Data-TCache.html#t:DBRef">DBRef</a> a]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">SetOperations [<a href="Data-TCache.html#t:DBRef">DBRef</a> a] (JoinData a a') (JoinData a a')</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Queriable reg a =&gt; <a href="Data-TCache-IndexQuery.html#t:RelationOps">RelationOps</a> (reg -&gt; a) a [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg', <a href="Data-TCache.html#t:IResource">IResource</a> reg', <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg' -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg']) (<a href="Data-TCache.html#t:STM">STM</a> [b])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg' -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> (JoinData reg reg')) (<a href="Data-TCache.html#t:STM">STM</a> [([a], [b])])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [b])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [(a, b)])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">SetOperations (JoinData a a') [<a href="Data-TCache.html#t:DBRef">DBRef</a> a'] (JoinData a a')</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">SetOperations (JoinData a a') [<a href="Data-TCache.html#t:DBRef">DBRef</a> a] (JoinData a a')</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(Queriable reg a, Queriable reg' a) =&gt; <a href="Data-TCache-IndexQuery.html#t:RelationOps">RelationOps</a> (reg -&gt; a) (reg' -&gt; a) (JoinData reg reg')</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [b]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; c) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [c])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg -&gt; b, reg -&gt; c) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [(a, b, c)])</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="Data-TCache.html#t:IResource">IResource</a> reg, <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [a]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; b) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [b]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; c) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [c]), <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; d) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [d])) =&gt; <a href="Data-TCache-IndexQuery.html#t:Select">Select</a> (reg -&gt; a, reg -&gt; b, reg -&gt; c, reg -&gt; d) (<a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache.html#t:DBRef">DBRef</a> reg]) (<a href="Data-TCache.html#t:STM">STM</a> [(a, b, c, d)])</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:getDBRef" class="def">getDBRef</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="Data-TCache.html#t:IResource">IResource</a> a) =&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a> -&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a</p><div class="doc"><p>Get the reference to the object in the cache. if it does not exist, the reference is created empty.
 Every execution of <code><a href="Data-TCache.html#v:getDBRef">getDBRef</a></code> returns the same unique reference to this key,
 so it can be safely considered pure. This is a property useful because deserialization
 of objects with unused embedded DBRef's  do not need to marshall them eagerly.
  Tbis also avoid unnecesary cache lookups of the pointed objects.
</p></div></div><div class="top"><p class="src"><a name="v:keyObjDBRef" class="def">keyObjDBRef</a> ::  <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a></p><div class="doc"><p>Return the key of the object pointed to by the DBRef
</p></div></div><div class="top"><p class="src"><a name="v:newDBRef" class="def">newDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; <a href="Data-TCache.html#t:STM">STM</a> (<a href="Data-TCache.html#t:DBRef">DBRef</a> a)</p><div class="doc"><p>Create the object passed as parameter (if it does not exist) and
-- return its reference in the IO monad.
-- If an object with the same key already exists, it is returned as is
-- If not, the reference is created with the new value.
-- If you like to update in any case, use <code><a href="Data-TCache.html#v:getDBRef">getDBRef</a></code> and <code><a href="Data-TCache.html#v:writeDBRef">writeDBRef</a></code> combined
newDBRefIO :: (IResource a,Typeable a) =&gt; a -&gt; IO (DBRef a)
newDBRefIO x= do
 let key = keyResource x
 mdbref &lt;- mDBRefIO key
 case mdbref of
   Right dbref -&gt; return dbref
</p><p>Left cache -&gt; do
     tv&lt;- newTVarIO  DoNotExist
     let dbref= DBRef key  tv
     w &lt;- mkWeakPtr  dbref . Just $ fixToCache dbref
     H.update cache key (CacheElem Nothing w)
     t &lt;-  timeInteger
     atomically $ do
       applyTriggers [dbref] [Just x]      --<code>debug</code> (<a href="before .html">before </a>++key)
       writeTVar tv  . Exist $ Elem x t t
       return dbref
</p><p>Create the object passed as parameter (if it does not exist) and
 return its reference in the STM monad.
 If an object with the same key already exists, it is returned as is
 If not, the reference is created with the new value.
 If you like to update in any case, use <code><a href="Data-TCache.html#v:getDBRef">getDBRef</a></code> and <code><a href="Data-TCache.html#v:writeDBRef">writeDBRef</a></code> combined
 if you  need to create the reference and the reference content, use <code><a href="Data-TCache.html#v:newDBRef">newDBRef</a></code>
</p></div></div><div class="top"><p class="src"><a name="v:readDBRef" class="def">readDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</p><div class="doc"><p>Return the reference value. If it is not in the cache, it is fetched
 from the database.
</p></div></div><div class="top"><p class="src"><a name="v:writeDBRef" class="def">writeDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Write in the reference a value
 The new key must be the same than the old key of the previous object stored
 otherwise, an error <a href="law of key conservation broken.html">law of key conservation broken</a> will be raised
</p><p>WARNING: the value to be written in the DBRef must be fully evaluated. Delayed evaluations at
 serialization time can cause inconsistencies in the database.
 In future releases this will be enforced.
</p></div></div><div class="top"><p class="src"><a name="v:delDBRef" class="def">delDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Delete the content of the DBRef form the cache and from permanent storage
</p></div></div><h1 id="g:3"><code>IResource</code> class
</h1><div class="doc"><p>cached objects must be instances of IResource.
Such instances can be implicitly derived trough auxiliary clasess for file persistence
</p></div><div class="top"><p class="src"><span class="keyword">class</span>  <a name="t:IResource" class="def">IResource</a> a  <span class="keyword">where</span></p><div class="doc"><p>Must be defined for every object to be cached.
</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:keyResource" class="def">keyResource</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a></td><td class="doc"><p>must be defined
</p></td></tr></table></div><p class="src"><a name="v:readResourceByKey" class="def">readResourceByKey</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</p><div class="doc"><p>Implements the database access and marshalling of the object.
        while the database access must be strict, the marshaling must be lazy if, as is often the case,
        some parts of the object are not really accesed.
        If the object contains DBRefs, this avoids unnecesary cache lookups.
        This method is called inside <code><a href="Data-TCache.html#v:atomically">atomically</a></code> blocks.
        Since STM transactions retry, readResourceByKey may be called twice in strange situations. So it must be idempotent, not only in the result but also in the effect in the database
        . However, because it is executed by <code>safeIOToSTM</code> it is guaranteed that the execution is not interrupted.
</p></div><p class="src"><a name="v:readResource" class="def">readResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</p><p class="src"><a name="v:writeResource" class="def">writeResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>To write into persistent storage. It must be strict.  
 Since STM transactions may retry, <code>writeResource</code> must be idempotent, not only in the result but also in the effect in the database.
 . However, because it is executed by <code>safeIOToSTM</code> it is guaranteed that the execution is not interrupted.
 All the new obbects are writeen to the database on synchromization,
 so writeResource must not autocommit.
 Commit code must be located in the postcondition. (see  <code>setConditions</code>)
 Since there is no provision for rollback from failure in writing to
 persistent storage, <code><a href="Data-TCache.html#v:writeResource">writeResource</a></code> must retry until success.
</p></div><p class="src"><a name="v:delResource" class="def">delResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Delete the resource. It is called syncronously. So it must tocommit   
</p></div></div><div class="subs instances"><p id="control.i:IResource" class="caption collapser" onclick="toggleSection('i:IResource')">Instances</p><div id="section.i:IResource" class="show"><table><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="Data-TCache-Defs.html#t:Indexable">Indexable</a> a, <a href="Data-TCache-Defs.html#t:Serializable">Serializable</a> a) =&gt; <a href="Data-TCache.html#t:IResource">IResource</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Queriable reg a =&gt; <a href="Data-TCache.html#t:IResource">IResource</a> (Index reg a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="Data-TCache-Defs.html#t:Indexable">Indexable</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:IResource">IResource</a> (Cached a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h1 id="g:4">Operations with cached objects
</h1><div class="doc"><p>implement inversion of control primitives where  the user defines the objects to retrive. The primitives
then call a the defined function that, determines how to transform the objects retrieved,wich are sent
back to the storage and a result is returned.
</p><p>In this example &quot;buy&quot; is a transaction where the user buy an item.
The spent amount is increased and the stock of the product is decreased:
</p><pre>
data  Data=   User{uname:: String, uid:: String, spent:: Int} |
              Item{iname:: String, iid:: String, price:: Int, stock:: Int}
              deriving (Read, Show)

instance Indexable Data where
        key   User{uid=id}= id
        key   Item{iid=id}= id

user <code>buy</code> item=  <code><a href="Data-TCache.html#v:withResources">withResources</a></code>[user,item] buyIt
 where
    buyIt[Just us,Just it]
       | stock it &gt; 0= [us',it']
       | otherwise   = error &quot;stock is empty for this product&quot;
      where
       us'= us{spent=spent us + price it}
       it'= it{stock= stock it-1}
    buyIt _ = error &quot;either the user or the item (or both) does not exist&quot;
</pre></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Resources" class="def">Resources</a> a b </p><div class="doc"><p>Resources data definition used by <code>withSTMResources</code>    
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Retry" class="def">Retry</a></td><td class="doc"><p>forces a retry
</p></td></tr><tr><td class="src"><a name="v:Resources" class="def">Resources</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:toAdd" class="def">toAdd</a> :: [a]</dt><dd class="doc"><p>resources to be inserted back in the cache
</p></dd><dt class="src"><a name="v:toDelete" class="def">toDelete</a> :: [a]</dt><dd class="doc"><p>resources to be deleted from the cache and from permanent storage
</p></dd><dt class="src"><a name="v:toReturn" class="def">toReturn</a> :: b</dt><dd class="doc"><p>result to be returned
</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:resources" class="def">resources</a> ::  <a href="Data-TCache.html#t:Resources">Resources</a> a <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Empty resources: <code>resources= Resources  [] [] ()</code>
</p></div></div><div class="top"><p class="src"><a name="v:withSTMResources" class="def">withSTMResources</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; [a]</td><td class="doc"><p>the list of resources to be retrieved
</p></td></tr><tr><td class="src">-&gt; ([<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a] -&gt; <a href="Data-TCache.html#t:Resources">Resources</a> a x)</td><td class="doc"><p>The function that process the resources found and return a Resources structure
</p></td></tr><tr><td class="src">-&gt; <a href="Data-TCache.html#t:STM">STM</a> x</td><td class="doc"><p>The return value in the STM monad.
</p></td></tr></table></div><div class="doc"><p>This is the main function for the *Resource(s) calls. All the rest derive from it. The results are kept in the STM monad
 so it can be part of a larger STM transaction involving other DBRefs.
 The <code><a href="Data-TCache.html#t:Resources">Resources</a></code> register  returned by the user-defined function  is interpreted as such:
</p><ul><li> <code><a href="Data-TCache.html#v:toAdd">toAdd</a></code>:  the content of this field will be added/updated to the cache
</li><li> <code><a href="Data-TCache.html#v:toDelete">toDelete</a></code>: the content of this field will be removed from the cache and from permanent storage
</li><li> <code><a href="Data-TCache.html#v:toReturn">toReturn</a></code>: the content of this field will be returned by <code><a href="Data-TCache.html#v:withSTMResources">withSTMResources</a></code>
</li></ul><p>WARNING: To catch evaluations errors at the right place, the values to be written must be fully evaluated.
 Errors in delayed evaluations at serialization time can cause inconsistencies in the database.
</p></div></div><div class="top"><p class="src"><a name="v:withResources" class="def">withResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; ([<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a] -&gt; [a]) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>To atomically add/modify many objects in the cache
</p><pre> withResources rs f=  atomically $ <code><a href="Data-TCache.html#v:withSTMResources">withSTMResources</a></code> rs f1 &gt;&gt; return() where   f1 mrs= let as= f mrs in  Resources  as [] ()</pre></div></div><div class="top"><p class="src"><a name="v:withResource" class="def">withResource</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a -&gt; a) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Update of a single object in the cache
</p><pre>withResource r f= <code><a href="Data-TCache.html#v:withResources">withResources</a></code> [r] ([mr]-&gt; [f mr])</pre></div></div><div class="top"><p class="src"><a name="v:getResources" class="def">getResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> [<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a]</p><div class="doc"><p>To read a list of resources from the cache if they exist
</p><p>| <code>getResources rs= atomically $ <code><a href="Data-TCache.html#v:withSTMResources">withSTMResources</a></code> rs f1 where  f1 mrs= Resources  [] [] mrs</code>
</p></div></div><div class="top"><p class="src"><a name="v:getResource" class="def">getResource</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</p><div class="doc"><p>To read a resource from the cache.
</p><pre>getResource r= do{mr&lt;- <code><a href="Data-TCache.html#v:getResources">getResources</a></code> [r];return $! head mr}</pre></div></div><div class="top"><p class="src"><a name="v:deleteResources" class="def">deleteResources</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; [a] -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Delete the list of resources from cache and from persistent storage.
</p><pre>  deleteResources rs= atomically $ <code><a href="Data-TCache.html#v:withSTMResources">withSTMResources</a></code> rs f1 where  f1 mrs = Resources  [] (catMaybes mrs) ()</pre></div></div><div class="top"><p class="src"><a name="v:deleteResource" class="def">deleteResource</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Delete the   resource from cache and from persistent storage.
</p><pre> deleteResource r= <code><a href="Data-TCache.html#v:deleteResources">deleteResources</a></code> [r]</pre></div></div><h1 id="g:5">Trigger operations
</h1><div class="doc"><p>Trriggers are called just before an object of the given type is created, modified or deleted.
The DBRef to the object and the new value is passed to the trigger.
The called trigger function has two parameters: the DBRef being accesed
(which still contains the old value), and the new value.
If the content of the DBRef is being deleted, the second parameter is <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#v:Nothing">Nothing</a></code>.
if the DBRef contains Nothing, then the object is being created
</p><p>Example:
</p><p>Every time a car is added, or deleted, the owner's list is updated.
This is done by the user defined trigger addCar
</p><pre>
 addCar pcar (Just(Car powner _ )) = addToOwner powner pcar
 addCar pcar Nothing  = readDBRef pcar &gt;&gt;= \(Just car)-&gt; deleteOwner (owner car) pcar

addToOwner powner pcar=do
    Just owner &lt;- readDBRef powner
    writeDBRef powner owner{cars= nub $ pcar : cars owner}

deleteOwner powner pcar= do
   Just owner &lt;- readDBRef powner
   writeDBRef powner owner{cars= delete  pcar $ cars owner}

main= do
    <code><a href="Data-TCache.html#v:addTrigger">addTrigger</a></code> addCar
    putStrLn &quot;create bruce's register with no cars&quot;
    bruce &lt;- <code><a href="Data-TCache.html#v:atomically">atomically</a></code> <code><a href="Data-TCache.html#v:newDBRef">newDBRef</a></code> $ Person &quot;Bruce&quot; []
    putStrLn &quot;add two car register with \<a href="bruce\.html">bruce\</a> as owner using the reference to the bruces register&quot;
    let newcars= [Car bruce &quot;Bat Mobile&quot; , Car bruce &quot;Porsche&quot;]
    insert newcars
    Just bruceData &lt;- atomically $ <code><a href="Data-TCache.html#v:readDBRef">readDBRef</a></code> bruce
    putStrLn &quot;the trigger automatically updated the car references of the Bruce register&quot;
    print . length $ cars bruceData
    print bruceData
</pre><p>gives:
</p><pre> main
 2
 Person {pname = &quot;Bruce&quot;, cars = [DBRef &quot;Car Porsche&quot;,DBRef &quot;Car Bat Mobile&quot;]}
</pre></div><div class="top"><p class="src"><a name="v:addTrigger" class="def">addTrigger</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; (<a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a>) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Add an user defined trigger to the list of triggers
Trriggers are called just before an object of the given type is created, modified or deleted.
The DBRef to the object and the new value is passed to the trigger.
The called trigger function has two parameters: the DBRef being accesed
(which still contains the old value), and the new value.
If the content of the DBRef is being deleted, the second parameter is <code><a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#v:Nothing">Nothing</a></code>.
if the DBRef contains Nothing, then the object is being created
</p></div></div><h1 id="g:6">Cache control
</h1><div class="top"><p class="src"><a name="v:flushDBRef" class="def">flushDBRef</a> :: (<a href="Data-TCache.html#t:IResource">IResource</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:DBRef">DBRef</a> a -&gt; <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Deletes the pointed object from the cache, not the database (see <code><a href="Data-TCache.html#v:delDBRef">delDBRef</a></code>)
 useful for cache invalidation when the database is modified by other process
</p></div></div><div class="top"><p class="src"><a name="v:flushAll" class="def">flushAll</a> :: <a href="Data-TCache.html#t:STM">STM</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>drops the entire cache.
</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Cache" class="def">Cache</a> = <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-IORef.html#t:IORef">IORef</a> (Ht, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a>)</p></div><div class="top"><p class="src"><a name="v:setCache" class="def">setCache</a> :: <a href="Data-TCache.html#t:Cache">Cache</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Set the cache. this is useful for hot loaded modules that will update an existing cache. Experimental
</p></div></div><div class="top"><p class="src"><a name="v:newCache" class="def">newCache</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (Ht, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a>)</p><div class="doc"><p>Creates a new cache. Experimental
</p></div></div><div class="top"><p class="src"><a name="v:syncCache" class="def">syncCache</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Force the atomic write of all cached objects modified since the last save into permanent storage.
 Cache writes allways save a coherent state. As allways, only the modified objects are written.
</p></div></div><div class="top"><p class="src"><a name="v:setConditions" class="def">setConditions</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>stablishes the procedures to call before and after saving with <code><a href="Data-TCache.html#v:syncCache">syncCache</a></code>, <code><a href="Data-TCache.html#v:clearSyncCache">clearSyncCache</a></code> or <code><a href="Data-TCache.html#v:clearSyncCacheProc">clearSyncCacheProc</a></code>. The postcondition of
 database persistence should be a commit.
</p></div></div><div class="top"><p class="src"><a name="v:clearSyncCache" class="def">clearSyncCache</a> :: (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Saves the unsaved elems of the cache.
 Cache writes allways save a coherent state.
  Unlike <code>syncChace</code> this call deletes some elems of  the cache when the number of elems &gt; <code>sizeObjects</code>.
  The deletion depends on the check criteria, expressed by the first parameter.
  <code><a href="Data-TCache.html#v:defaultCheck">defaultCheck</a></code> is the one implemented to be passed by default. Look at it to understand the clearing criteria.
</p></div></div><div class="top"><p class="src"><a name="v:numElems" class="def">numElems</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></p><div class="doc"><p>Return the  total number of DBRefs in the cache. For debug purposes.
 This does not count the number of objects in the cache since many of the DBRef
 may not have the pointed object loaded. It's O(n).
</p></div></div><div class="top"><p class="src"><a name="v:syncWrite" class="def">syncWrite</a> :: <a href="Data-TCache.html#t:SyncMode">SyncMode</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Specify the cache synchronization policy with permanent storage. See <code><a href="Data-TCache.html#t:SyncMode">SyncMode</a></code> for details
</p></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:SyncMode" class="def">SyncMode</a>  </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Synchronous" class="def">Synchronous</a></td><td class="doc"><p>sync state to permanent storage when <code><a href="Data-TCache.html#v:atomicallySync">atomicallySync</a></code> is invoked
</p></td></tr><tr><td class="src"><a name="v:Asyncronous" class="def">Asyncronous</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:frecuency" class="def">frecuency</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></dt><dd class="doc"><p>number of seconds between saves when asyncronous
</p></dd><dt class="src"><a name="v:check" class="def">check</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a></dt><dd class="doc"><p>The user-defined check-for-cleanup-from-cache for each object. <code><a href="Data-TCache.html#v:defaultCheck">defaultCheck</a></code> is an example
</p></dd><dt class="src"><a name="v:cacheSize" class="def">cacheSize</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></dt><dd class="doc"><p>size of the cache when async
</p></dd></dl><div class="clear"></div></div></td></tr><tr><td class="src"><a name="v:SyncManual" class="def">SyncManual</a></td><td class="doc"><p>use <code><a href="Data-TCache.html#v:syncCache">syncCache</a></code> to write the state
</p></td></tr></table></div></div><div class="top"><p class="src"><a name="v:clearSyncCacheProc" class="def">clearSyncCacheProc</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>number of seconds betwen checks. objects not written to disk are written
</p></td></tr><tr><td class="src">-&gt; (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a>)</td><td class="doc"><p>The user-defined check-for-cleanup-from-cache for each object. <code><a href="Data-TCache.html#v:defaultCheck">defaultCheck</a></code> is an example
</p></td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The max number of objects in the cache, if more, the  cleanup starts
</p></td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Concurrent.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Identifier of the thread created
</p></td></tr></table></div><div class="doc"><p>Start the thread that periodically call <code><a href="Data-TCache.html#v:clearSyncCache">clearSyncCache</a></code> to clean and writes on the persistent storage.
 Otherwise, <code><a href="Data-TCache.html#v:syncCache">syncCache</a></code> or <code><a href="Data-TCache.html#v:clearSyncCache">clearSyncCache</a></code> or <code><a href="Data-TCache.html#v:atomicallySync">atomicallySync</a></code> must be invoked explicitly or no persistence will exist.
 Cache writes allways save a coherent state
</p></div></div><div class="top"><p class="src"><a name="v:defaultCheck" class="def">defaultCheck</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a></td><td class="doc"><p>current time in seconds
</p></td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a></td><td class="doc"><p>last access time for a given object
</p></td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Prelude.html#t:Integer">Integer</a></td><td class="doc"><p>last cache syncronization (with the persisten storage)
</p></td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Bool.html#t:Bool">Bool</a></td><td class="doc"><p>return true for all the elems not accesed since half the time between now and the last sync
</p></td></tr></table></div><div class="doc"><p>This is a default cache clearance check. It forces to drop from the cache all the
 elems not accesed since half the time between now and the last sync
 if it returns True, the object will be discarded from the cache
 it is invoked when the cache size exceeds the number of objects configured
 in <code><a href="Data-TCache.html#v:clearSyncCacheProc">clearSyncCacheProc</a></code> or <code><a href="Data-TCache.html#v:clearSyncCache">clearSyncCache</a></code>
</p></div></div><h1 id="g:7">Other
</h1><div class="top"><p class="src"><a name="v:onNothing" class="def">onNothing</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; m (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) -&gt; m b -&gt; m b</p><div class="doc"><p>Handles Nothing cases in a simpler way than runMaybeT.
 it is used in infix notation. for example:
</p><pre>result &lt;- readDBRef ref `onNothing` error (&quot;Not found &quot;++ keyObjDBRef ref)</pre><p>or
</p><pre>result &lt;- readDBRef ref `onNothing` return someDefaultValue</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>