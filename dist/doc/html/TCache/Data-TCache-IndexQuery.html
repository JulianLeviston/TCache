<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.TCache.IndexQuery</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Data-TCache-IndexQuery.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">TCache-0.12.0: A Transactional cache with user-defined persistence</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Data.TCache.IndexQuery</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module implements an experimental typed query language for TCache build on pure
haskell. It is minimally intrusive (no special data definitions, no special syntax, no template
haskell). It uses the same register fields from the data definitions. Both for query conditions
 and selections. It is executed in haskell, no external database support is needed.
</p><p>it includes
</p><ul><li> A method for triggering the <code><a href="Data-TCache-IndexQuery.html#v:index">index</a></code>-ation of the record fields that you want to query
</li><li> A typed query language of these record fields, with:
</li><li> Relational operators:  <code><a href="Data-TCache-IndexQuery.html#v:.-61--61-.">.==.</a></code> <code><a href="Data-TCache-IndexQuery.html#v:.-62-.">.&gt;.</a></code> <code><a href="Data-TCache-IndexQuery.html#v:.-62--61-.">.&gt;=.</a></code> <code><a href="Data-TCache-IndexQuery.html#v:.-60--61-.">.&lt;=.</a></code> <code><a href="Data-TCache-IndexQuery.html#v:.-60-.">.&lt;.</a></code> <code><a href="Data-TCache-IndexQuery.html#v:.-38--38-.">.&amp;&amp;.</a></code> <code><a href="Data-TCache-IndexQuery.html#v:.-124--124-.">.||.</a></code> to compare fields with
       values (returning lists of DBRefs) or fields between them, returning joins (lists of pairs of
       lists of DBRefs that meet the condition).
</li><li> a <code><a href="Data-TCache-IndexQuery.html#v:select">select</a></code> method to extract tuples of field values from the  DBRefs
</li><li> a <code><a href="Data-TCache-IndexQuery.html#v:recordsWith">recordsWith</a></code> clause to extract entire registers
</li></ul><p>An example that register the owner and name fields fo the Car register and the
name of the Person register, create the Bruce register, return the Bruce DBRef, create two Car registers with bruce as owner
and query for the registers with bruce as owner and its name alpabeticaly higuer than &quot;Bat mobile&quot;
</p><pre>
import <a href="Data-TCache.html">Data.TCache</a>
import <a href="Data-TCache-IndexQuery.html">Data.TCache.IndexQuery</a>
import <a href="Data-TCache-DefaultPersistence.html">Data.TCache.DefaultPersistence</a>
import <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable.html">Data.Typeable</a>

data Person= Person {pname :: String} deriving  (Show, Read, Eq, Typeable)
data Car= Car{owner :: DBRef Person , cname:: String} deriving (Show, Read, Eq, Typeable)

instance <code><a href="Data-TCache-Defs.html#t:Indexable">Indexable</a></code> Person where key Person{pname= n} = &quot;Person &quot; ++ n
instance <code><a href="Data-TCache-Defs.html#t:Indexable">Indexable</a></code> Car where key Car{cname= n} = &quot;Car &quot; ++ n

main =  do
   <code><a href="Data-TCache-IndexQuery.html#v:index">index</a></code> owner
   <code><a href="Data-TCache-IndexQuery.html#v:index">index</a></code> pname
   <code><a href="Data-TCache-IndexQuery.html#v:index">index</a></code> cname
   bruce &lt;- atomically $ <code><a href="Data-TCache.html#v:newDBRef">newDBRef</a></code> $ Person &quot;bruce&quot;
   atomically $  mapM_ <code><a href="Data-TCache.html#v:newDBRef">newDBRef</a></code> [Car bruce &quot;Bat Mobile&quot;, Car bruce &quot;Porsche&quot;]
   r &lt;- atomically $ cname <code><a href="Data-TCache-IndexQuery.html#v:.-61--61-.">.==.</a></code> &quot;Porsche&quot;
   print r
   r &lt;- atomically $ <code><a href="Data-TCache-IndexQuery.html#v:select">select</a></code> (cname, owner) $  owner <code><a href="Data-TCache-IndexQuery.html#v:.-61--61-.">.==.</a></code> bruce <code><a href="Data-TCache-IndexQuery.html#v:.-38--38-.">.&amp;&amp;.</a></code> cname <code><a href="Data-TCache-IndexQuery.html#v:.-62--61-.">.&gt;=.</a></code> &quot;Bat Mobile&quot;
   print r
</pre><p>Will produce:
</p><pre> [DBRef &quot;Car Porsche&quot;]
 [(&quot;Porsche&quot;,DBRef &quot;Person bruce&quot;)]
</pre><p>NOTES:
</p><ul><li> the index is instance of <code><a href="Data-TCache-Defs.html#t:Indexable">Indexable</a></code> and <code><a href="Data-TCache-Defs.html#t:Serializable">Serializable</a></code>. This can be used to
persist in the user-defined storage using DefaultPersistence
</li><li> The Join feature has not been properly tested
</li><li> Record fields are recognized by its type, so if we define two record fields
with the same type:
</li></ul><pre> data Person = Person {name , surname :: String}
</pre><p>then a query for <code>name <code><a href="Data-TCache-IndexQuery.html#v:.-61--61-.">.==.</a></code> <a href="Bruce.html">Bruce</a></code>  is indistinguishable from <code>surname <code><a href="Data-TCache-IndexQuery.html#v:.-61--61-.">.==.</a></code> <a href="Bruce.html">Bruce</a></code>
</p><p>Will return indexOf the registers with surname <a href="Bruce.html">Bruce</a> as well. So if two or more
fields in a registers are to be indexed, they must have different types.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:index">index</a> :: <a href="Data-TCache-IndexQuery.html#t:Queriable">Queriable</a> reg a =&gt; (reg -&gt; a) -&gt; <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:.-61--61-.">(.==.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</li><li class="src short"><a href="#v:.-60-.">(.&lt;.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</li><li class="src short"><a href="#v:.-60--61-.">(.&lt;=.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</li><li class="src short"><a href="#v:.-62--61-.">(.&gt;=.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</li><li class="src short"><a href="#v:.-62-.">(.&gt;.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</li><li class="src short"><a href="#v:indexOf">indexOf</a> :: <a href="Data-TCache-IndexQuery.html#t:Queriable">Queriable</a> reg a =&gt; (reg -&gt; a) -&gt; <a href="Data-TCache.html#t:STM">STM</a> [(a, [<a href="Data-TCache-Defs.html#t:DBRef">DBRef</a> reg])]</li><li class="src short"><a href="#v:recordsWith">recordsWith</a> :: (<a href="Data-TCache-IResource.html#t:IResource">IResource</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache-Defs.html#t:DBRef">DBRef</a> a] -&gt; <a href="Data-TCache.html#t:STM">STM</a> [a]</li><li class="src short"><a href="#v:.-38--38-.">(.&amp;&amp;.)</a> :: SetOperations set set' setResult =&gt; <a href="Data-TCache.html#t:STM">STM</a> set -&gt; <a href="Data-TCache.html#t:STM">STM</a> set' -&gt; <a href="Data-TCache.html#t:STM">STM</a> setResult</li><li class="src short"><a href="#v:.-124--124-.">(.||.)</a> :: SetOperations set set' setResult =&gt; <a href="Data-TCache.html#t:STM">STM</a> set -&gt; <a href="Data-TCache.html#t:STM">STM</a> set' -&gt; <a href="Data-TCache.html#t:STM">STM</a> setResult</li><li class="src short"><a href="#v:select">select</a> :: Select selector a res =&gt; selector -&gt; a -&gt; res</li><li class="src short"><span class="keyword">class</span> (<a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> a, <a href="Data-TCache-IResource.html#t:IResource">IResource</a> reg, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> a, <a href="Data-TCache-Defs.html#t:PersistIndex">PersistIndex</a> reg) =&gt; <a href="#t:Queriable">Queriable</a> reg a </li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:index" class="def">index</a> :: <a href="Data-TCache-IndexQuery.html#t:Queriable">Queriable</a> reg a =&gt; (reg -&gt; a) -&gt; <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Register a trigger for indexing the values of the field passed as parameter.
 the indexed field can be used to perform relational-like searches
</p></div></div><div class="top"><p class="src"><a name="v:.-61--61-." class="def">(.==.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</p></div><div class="top"><p class="src"><a name="v:.-60-." class="def">(.&lt;.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</p></div><div class="top"><p class="src"><a name="v:.-60--61-." class="def">(.&lt;=.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</p></div><div class="top"><p class="src"><a name="v:.-62--61-." class="def">(.&gt;=.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</p></div><div class="top"><p class="src"><a name="v:.-62-." class="def">(.&gt;.)</a> :: RelationOps field1 field2 res =&gt; field1 -&gt; field2 -&gt; <a href="Data-TCache.html#t:STM">STM</a> res</p></div><div class="top"><p class="src"><a name="v:indexOf" class="def">indexOf</a> :: <a href="Data-TCache-IndexQuery.html#t:Queriable">Queriable</a> reg a =&gt; (reg -&gt; a) -&gt; <a href="Data-TCache.html#t:STM">STM</a> [(a, [<a href="Data-TCache-Defs.html#t:DBRef">DBRef</a> reg])]</p><div class="doc"><p>return all  the (indexed)  values which this field has and a DBRef pointer to the register
</p></div></div><div class="top"><p class="src"><a name="v:recordsWith" class="def">recordsWith</a> :: (<a href="Data-TCache-IResource.html#t:IResource">IResource</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache.html#t:STM">STM</a> [<a href="Data-TCache-Defs.html#t:DBRef">DBRef</a> a] -&gt; <a href="Data-TCache.html#t:STM">STM</a> [a]</p></div><div class="top"><p class="src"><a name="v:.-38--38-." class="def">(.&amp;&amp;.)</a> :: SetOperations set set' setResult =&gt; <a href="Data-TCache.html#t:STM">STM</a> set -&gt; <a href="Data-TCache.html#t:STM">STM</a> set' -&gt; <a href="Data-TCache.html#t:STM">STM</a> setResult</p></div><div class="top"><p class="src"><a name="v:.-124--124-." class="def">(.||.)</a> :: SetOperations set set' setResult =&gt; <a href="Data-TCache.html#t:STM">STM</a> set -&gt; <a href="Data-TCache.html#t:STM">STM</a> set' -&gt; <a href="Data-TCache.html#t:STM">STM</a> setResult</p></div><div class="top"><p class="src"><a name="v:select" class="def">select</a> :: Select selector a res =&gt; selector -&gt; a -&gt; res</p></div><div class="top"><p class="src"><span class="keyword">class</span> (<a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> a, <a href="Data-TCache-IResource.html#t:IResource">IResource</a> reg, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> a, <a href="Data-TCache-Defs.html#t:PersistIndex">PersistIndex</a> reg) =&gt; <a name="t:Queriable" class="def">Queriable</a> reg a </p><div class="subs instances"><p id="control.i:Queriable" class="caption collapser" onclick="toggleSection('i:Queriable')">Instances</p><div id="section.i:Queriable" class="show"><table><tr><td class="src">(<a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Text-Read.html#t:Read">Read</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Text-Show.html#t:Show">Show</a> a, <a href="Data-TCache-IResource.html#t:IResource">IResource</a> reg, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> reg, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="file://C:\Program Files (x86)\Haskell Platform\2013.2.0.0\lib/../doc/html/libraries/base-4.6.0.1/Data-Ord.html#t:Ord">Ord</a> a, <a href="Data-TCache-Defs.html#t:PersistIndex">PersistIndex</a> reg) =&gt; <a href="Data-TCache-IndexQuery.html#t:Queriable">Queriable</a> reg a</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>