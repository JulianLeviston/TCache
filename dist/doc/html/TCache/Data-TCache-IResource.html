<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Data.TCache.IResource</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Data-TCache-IResource.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">TCache-0.10.0.0: A Transactional cache with user-defined persistence</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">Data.TCache.IResource</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">class</span>  <a href="#t:IResource">IResource</a> a  <span class="keyword">where</span><ul class="subs"><li><a href="#v:keyResource">keyResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a></li><li><a href="#v:readResourceByKey">readResourceByKey</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li><a href="#v:readResource">readResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li><a href="#v:writeResource">writeResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li><li><a href="#v:delResource">delResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li></ul></li><li class="src short"><span class="keyword">data</span>  <a href="#t:Resources">Resources</a> a b<ul class="subs"><li>= <a href="#v:Retry">Retry</a>  </li><li>| <a href="#v:Resources">Resources</a> { <ul class="subs"><li><a href="#v:toAdd">toAdd</a> :: [a]</li><li><a href="#v:toDelete">toDelete</a> :: [a]</li><li><a href="#v:toReturn">toReturn</a> :: b</li></ul> }</li></ul></li><li class="src short"><a href="#v:resources">resources</a> ::  <a href="Data-TCache-IResource.html#t:Resources">Resources</a> a <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">class</span>  <a name="t:IResource" class="def">IResource</a> a  <span class="keyword">where</span></p><div class="doc"><p>Must be defined for every object to be cached.
</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:keyResource" class="def">keyResource</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a></td><td class="doc"><p>must be defined
</p></td></tr></table></div><p class="src"><a name="v:readResourceByKey" class="def">readResourceByKey</a> :: <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-String.html#t:String">String</a> -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</p><div class="doc"><p>Implements the database access and marshalling of the object.
        while the database access must be strict, the marshaling must be lazy if, as is often the case,
        some parts of the object are not really accesed.
        If the object contains DBRefs, this avoids unnecesary cache lookups.
        This method is called inside <code><a href="Data-TCache.html#v:atomically">atomically</a></code> blocks.
        Since STM transactions retry, readResourceByKey may be called twice in strange situations. So it must be idempotent, not only in the result but also in the effect in the database
        . However, because it is executed by <code>safeIOToSTM</code> it is guaranteed that the execution is not interrupted.
</p></div><p class="src"><a name="v:readResource" class="def">readResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> (<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</p><p class="src"><a name="v:writeResource" class="def">writeResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>To write into persistent storage. It must be strict.  
 Since STM transactions may retry, <code>writeResource</code> must be idempotent, not only in the result but also in the effect in the database.
 . However, because it is executed by <code>safeIOToSTM</code> it is guaranteed that the execution is not interrupted.
 All the new obbects are writeen to the database on synchromization,
 so writeResource must not autocommit.
 Commit code must be located in the postcondition. (see  <code>setConditions</code>)
 Since there is no provision for rollback from failure in writing to
 persistent storage, <code><a href="Data-TCache-IResource.html#v:writeResource">writeResource</a></code> must retry until success.
</p></div><p class="src"><a name="v:delResource" class="def">delResource</a> :: a -&gt; <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/System-IO.html#t:IO">IO</a> <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Delete the resource. It is called syncronously. So it must tocommit   
</p></div></div><div class="subs instances"><p id="control.i:IResource" class="caption collapser" onclick="toggleSection('i:IResource')">Instances</p><div id="section.i:IResource" class="show"><table><tr><td class="src">(<a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a, <a href="Data-TCache-Defs.html#t:Indexable">Indexable</a> a, <a href="Data-TCache-Defs.html#t:Serializable">Serializable</a> a) =&gt; <a href="Data-TCache-IResource.html#t:IResource">IResource</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">Queriable reg a =&gt; <a href="Data-TCache-IResource.html#t:IResource">IResource</a> (Index reg a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">(<a href="Data-TCache-Defs.html#t:Indexable">Indexable</a> a, <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/base-4.5.0.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> a) =&gt; <a href="Data-TCache-IResource.html#t:IResource">IResource</a> (Cached a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Resources" class="def">Resources</a> a b </p><div class="doc"><p>Resources data definition used by <code>withSTMResources</code>    
</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Retry" class="def">Retry</a></td><td class="doc"><p>forces a retry
</p></td></tr><tr><td class="src"><a name="v:Resources" class="def">Resources</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:toAdd" class="def">toAdd</a> :: [a]</dt><dd class="doc"><p>resources to be inserted back in the cache
</p></dd><dt class="src"><a name="v:toDelete" class="def">toDelete</a> :: [a]</dt><dd class="doc"><p>resources to be deleted from the cache and from permanent storage
</p></dd><dt class="src"><a name="v:toReturn" class="def">toReturn</a> :: b</dt><dd class="doc"><p>result to be returned
</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:resources" class="def">resources</a> ::  <a href="Data-TCache-IResource.html#t:Resources">Resources</a> a <a href="C:\Program Files (x86)\Haskell Platform\2012.2.0.0\lib/../doc/html/libraries/ghc-prim-0.2.0.0/GHC-Tuple.html#t:-40--41-">()</a></p><div class="doc"><p>Empty resources: <code>resources= Resources  [] [] ()</code>
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.10.0</p></div></body></html>